<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Activity Tracker</title>
  <style>
    /* Styles CSS ici... */
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAJapQ7Y2iwW49alBkG3UsKl8Lq4D8mWwU",
      authDomain: "last-9aee8.firebaseapp.com",
      projectId: "last-9aee8",
      storageBucket: "last-9aee8.appspot.com",
      messagingSenderId: "543978749666",
      appId: "1:543978749666:web:0587a84de496dd7073a8bb",
      measurementId: "G-SCY61WX3QH"
    };

    // Initialiser Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const firestore = getFirestore(app);

    // Fonction pour enregistrer les points de la journée
    async function saveDailyPoints(userId, date, points) {
      const docRef = doc(firestore, `users/${userId}/dailyPoints/${date}`);
      await setDoc(docRef, { points: increment(points) }, { merge: true });
    }

    // Fonction pour charger les points totaux de la journée
    async function loadDailyPoints(userId, date) {
      const docRef = doc(firestore, `users/${userId}/dailyPoints/${date}`);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        return docSnap.data().points;
      } else {
        return 0;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          // Afficher la section des activités
          document.getElementById('activity-section').style.display = 'block';
          const userId = user.uid;

          // Charger les points totaux de la journée actuelle
          const today = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD
          const totalPoints = await loadDailyPoints(userId, today);
          document.getElementById('result').innerText = `Total Points: ${totalPoints}`;

          // Gérer l'envoi du formulaire
          document.getElementById('activityForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            // Lire les valeurs du formulaire
            const sportHours = parseFloat(document.getElementById('sportHours').value) || 0;
            const revisionHours = parseFloat(document.getElementById('revisionHours').value) || 0;
            const travailHours = parseFloat(document.getElementById('travailHours').value) || 0;
            const pratiqueReligieuse = document.getElementById('pratiqueReligieuse').checked ? 1 : 0;
            const lectureHours = parseFloat(document.getElementById('lectureHours').value) || 0;
            const alimentationSaine = document.getElementById('alimentationSaine').checked ? 1 : 0;

            // Calculer les points (à adapter selon vos règles de points)
            const points = sportHours * 5 + revisionHours * 3 + travailHours * 4 + pratiqueReligieuse * 2 + lectureHours * 6 + alimentationSaine * 1;

            // Enregistrer les points de la journée
            await saveDailyPoints(userId, today, points);

            // Mettre à jour l'affichage des points
            const updatedTotalPoints = await loadDailyPoints(userId, today);
            document.getElementById('result').innerText = `Total Points: ${updatedTotalPoints}`;
          });
        } else {
          // Si l'utilisateur n'est pas connecté, cacher la section des activités
          document.getElementById('activity-section').style.display = 'none';
        }
      });
    });
  </script>
</head>
<body>
  <!-- Section des activités -->
  <div id="activity-section" style="display: none;">
    <h1>Daily Activity Tracker</h1>
    <div class="result" id="result">Total Points: 0</div>
    <form id="activityForm">
      <div class="form-group">
        <label for="sportHours">Sport (hours):</label>
        <input type="number" id="sportHours" min="0" step="1">
      </div>
      <div class="form-group">
        <label for="revisionHours">Revision (hours):</label>
        <input type="number" id="revisionHours" min="0" step="1">
      </div>
      <div class="form-group">
        <label for="travailHours">Travail (hours):</label>
        <input type="number" id="travailHours" min="0" step="1">
      </div>
      <div class="form-group">
        <label for="pratiqueReligieuse">Pratique religieuse:</label>
        <input type="checkbox" id="pratiqueReligieuse">
      </div>
      <div class="form-group">
        <label for="lectureHours">Lecture (hours):</label>
        <input type="number" id="lectureHours" min="0" step="1">
      </div>
      <div class="form-group">
        <label for="alimentationSaine">Alimentation saine:</label>
        <input type="checkbox" id="alimentationSaine">
      </div>
      <button type="submit">Submit</button>
    </form>
  </div>
</body>
</html>
